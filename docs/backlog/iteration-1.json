{
  "iteration": 1,
  "name": "The Expat Identity",
  "status": "in-progress",
  "goal": "Implement Tenant and User onboarding with Skunk persistence and Outbox-based CloudEvent publishing.",
  "tasks": [
    {
      "id": "T1.1",
      "title": "Setup Skunk Persistence & Flyway",
      "status": "done",
      "owner": "Junie",
      "description": "Integrate Skunk and Flyway. Create schemas for 'tenant', 'tenant_tax_residency', and 'user'. Enforce UUID PKs and UTC timestamps."
    },
    {
      "id": "T1.2",
      "title": "Implement Outbox Pattern Infrastructure",
      "status": "done",
      "owner": "Junie",
      "description": "Create an 'outbox' table. Implement a base repository trait to save domain events atomically with domain entities using Skunk transactions."
    },
    {
      "id": "T1.3",
      "title": "Implement 'Onboard Tenant' Use Case",
      "status": "done",
      "owner": "Junie",
      "description": "Implement Hexagonal layers for Tenant creation. Logic must handle the initial tax residency and reporting currency selection."
    },
    {
      "id": "T1.4",
      "title": "Outbox Poller & CloudEvent Publisher",
      "status": "done",
      "owner": "Junie",
      "description": "Implemented an fs2-based background stream in tenant-service to poll the outbox and publish Avro-encoded CloudEvents to RabbitMQ."
    },
    {
      "id": "T1.5",
      "title": "Tenant API gRPC & Gateway Bridge",
      "status": "done",
      "owner": "Junie",
      "description": "Implemented TenantGrpcAdapter to wire TenantService logic to gRPC. Updated Main.scala to use real service implementation via Guice."
    },
    {
      "id": "T1.6",
      "title": "Persistence Integration Test (Testcontainers)",
      "status": "todo",
      "owner": "Junie",
      "description": "Use Testcontainers-scala to verify that Tenants and their tax residencies are saved correctly and events appear in the outbox."
    },
    {
      "id": "T1.7",
      "title": "Consolidate Guidelines",
      "status": "done",
      "owner": "Junie",
      "description": "Consolidated .junierules and AGENTS.md into .junie/guidelines.md to establish a single source of truth for development agents."
    },
    {
      "id": "T1.8",
      "title": "Rich Event Model Refactoring",
      "status": "done",
      "owner": "Junie",
      "description": "Refactor events to use a base 'Event' trait and concrete case classes for 'DomainEvent' and 'OutboxEvent' to improve type safety and ergonomics."
    },
    {
      "id": "T1.9",
      "title": "Optimize Outbox Batch Inserts",
      "status": "done",
      "owner": "Junie",
      "description": "Use Skunk's insertMany to optimize batch inserts in OutboxRepository, reducing round-trips to the database."
    },
    {
      "id": "T1.10",
      "title": "Fix brittle eventType derivation",
      "status": "done",
      "owner": "Junie",
      "description": "Refactor Repository to use DomainEvent.eventType instead of getClass.getSimpleName to avoid coupling with code structure."
    },
    {
      "id": "T1.11",
      "title": "Fix Python Version in .tool-versions",
      "status": "done",
      "owner": "Junie",
      "description": "Corrected the invalid Python version 3.14.2 to 3.12.0 in .tool-versions and updated README to clarify Python's purpose."
    },
    {
      "id": "T1.13",
      "title": "Optimize OutboxRepository saveAll performance",
      "status": "done",
      "owner": "Junie",
      "description": "Group chunks by size in saveAll to minimize prepare calls."
    },
    {
      "id": "T1.15",
      "title": "Fix Skunk transactional compilation error",
      "status": "done",
      "owner": "Junie",
      "description": "Fixed compilation error in Repository.scala caused by using non-existent session.transactional method."
    },
    {
      "id": "T1.16",
      "title": "Enforce 'One Entity Per File' Rule",
      "status": "done",
      "owner": "Junie",
      "description": "Split multi-model files across the project (domain, events, config, service requests) into individual files to improve maintainability and discoverability."
    },
    {
      "id": "T1.17",
      "title": "Enforce DDD & Hexagonal Architecture",
      "status": "done",
      "owner": "Junie",
      "description": "Refactor project structure to strictly separate domain, application, and infrastructure layers. Introduce UnitOfWork port and move repository interfaces to the domain."
    },
    {
      "id": "T1.18",
      "title": "Separate Service Contract from Implementation",
      "status": "done",
      "owner": "Junie",
      "description": "Moved TenantService trait and TenantServiceLive implementation into separate files to improve code organization and support dependency injection."
    },
    {
      "id": "T1.19",
      "title": "Implement Dependency Injection with Scala 3 Contextual Abstractions",
      "status": "done",
      "owner": "Junie",
      "description": "Introduced a native DI framework using Scala 3's given/using. Refactored TenantService and created TenantContainer for compile-time wiring."
    },
    {
      "id": "T1.20",
      "title": "Standardize Dependency Injection with Google Guice",
      "status": "done",
      "owner": "Junie",
      "description": "Replaced Scala 3 contextual DI with Google Guice 7.0. Created TenantModule and updated service wiring to use @Inject and constructor injection. (Superseded by T1.25)"
    },
    {
      "id": "T1.25",
      "title": "Adopt Manual Dependency Injection",
      "status": "done",
      "owner": "Junie",
      "description": "Discarded Google Guice in favor of manual wiring to ensure 100% compile-time safety and resource integrity with cats-effect."
    },
    {
      "id": "T1.21",
      "title": "Batch Insert Tenant Tax Residencies",
      "status": "done",
      "owner": "Junie",
      "description": "Optimized SkunkTenantRepository to save all tax residencies in a single database round-trip using batch inserts."
    },
    {
      "id": "T1.22",
      "title": "Enhance Outbox Poller Error Handling & Logging",
      "status": "done",
      "owner": "Junie",
      "description": "Implement robust error handling for failed event publishing, including retries with exponential backoff and structured logging using log4cats. Ensure stack safety by replacing recursive stream restarts with native fs2 operators."
    },
    {
      "id": "T1.23",
      "title": "Fix and Standardize Pre-commit Hook Setup",
      "status": "done",
      "owner": "Junie",
      "description": "Fixed pre-commit hook execution by using 'python -m pre_commit'. Removed obsolete Java formatting hooks and updated README/Makefile for better developer onboarding."
    },
    {
      "id": "T1.24",
      "title": "Decouple Event Schemas from Code",
      "status": "done",
      "owner": "Junie",
      "description": "Refactor DomainEvents to load Avro schemas from external .avsc files instead of hardcoding them as JSON strings. Implement AvroSchemaLoader in shared-kernel."
    },
    {
      "id": "TASK-12",
      "title": "Remove owner concept from tenant creation",
      "status": "completed",
      "owner": "Junie",
      "requirement": "FR-1"
    },
    {
      "id": "TASK-13",
      "title": "Fix tenant-service test dependencies",
      "status": "completed",
      "owner": "Junie",
      "requirement": "Technical Debt"
    },
    {
      "id": "TASK-14",
      "title": "Refactor EventType to use Enumeratum",
      "status": "completed",
      "owner": "Junie",
      "requirement": "Technical Debt"
    },
    {
      "id": "TASK-15",
      "title": "Improve AvroSchemaLoader error handling",
      "status": "completed",
      "owner": "Junie",
      "requirement": "Technical Debt"
    },
    {
      "id": "TASK-16",
      "title": "Make OutboxPoller retry parameters configurable",
      "status": "completed",
      "owner": "Junie",
      "requirement": "Technical Debt"
    }
  ]
}
